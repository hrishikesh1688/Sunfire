<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record model="ir.ui.view" id="view_order_form_inherited_123">
        <field name="name">sale.order.inherit</field>
        <field name="model">sale.order</field>
        <field name="inherit_id" ref="sale.view_order_form"/>
        <field name="arch" type="xml">

            <!--######## Button Group Access Rights #############################-->
            <xpath expr="//button[@name='action_cancel']" position="replace">
                <button name="action_cancel" states="draft" type="object" string="Cancel Quotation" groups="sunfire_sales.sale_button_user"/>
                <button name="action_cancel" states="sent,sale" type="object" string="Cancel OPF" groups="sunfire_sales.sale_button_user"/>
            </xpath>

            <xpath expr="//button[@name='action_done']" position="replace">
                <button name="action_done" type="object" string="Approve OPF" states="sale" groups="sunfire_sales.sale_button_user" help="If the sale is locked, you can not modify it anymore. However, you will still be able to invoice or deliver."/>
            </xpath>

            <xpath expr="//button[@name='action_unlock']" position="replace">
                <button name="action_unlock" type="object" string="Un-approve OPF" states="done" groups="sunfire_sales.sale_button_user"/>
            </xpath>


            <!--Confirm Sale Button name Change only-->
            <xpath expr="//button[@name='action_confirm'][2]" position="replace">
                <button name="action_confirm" string="Create OPF" type="object" attrs="{'invisible': [('state', 'not in', ['draft'])]}"/>
            </xpath>
<xpath expr="//button[@name='action_confirm'][1]" position="replace">
 <button name="action_confirm" id="action_confirm" string="Create OPF" class="btn-primary" type="object" attrs="{'invisible': [('state', 'not in', ['sent'])]}" />                	
 	</xpath>
            <!-- Print Buttons Invisible -->
            <xpath expr="//button[@name='print_quotation'][1]" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            <xpath expr="//button[@name='print_quotation'][2]" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            <!--"Create Invoice" Button of Sale.order -->
            <xpath expr="//button[@name='%(sale.action_view_sale_advance_payment_inv)d'][1]" position="replace">
                <button name="%(sale.action_view_sale_advance_payment_inv)d" string="Create Invoice" type="action" context="{'default_advance_payment_method': 'percentage'}" attrs="{'invisible': ['|',('invoice_status', '!=','to invoice')]}" groups="sunfire_sales.sale_create_invoice_button_user"/>
            </xpath>
            <!--Smart Button 'Delivery' Visibility-->
            <xpath expr="//button[@name='action_view_delivery']" position="replace">
                <button type="object" name="action_view_delivery" class="oe_stat_button" icon="fa-truck" attrs="{'invisible': [('delivery_count', '=', 0)]}" groups="sunfire_sales.smart_delivery_button_user">
                    <field name="delivery_count" widget="statinfo" string="Delivery"/>
                </button>
            </xpath>
            <!--Smart Button 'Invoices' Visibility-->
            <xpath expr="//button[@name='action_view_invoice']" position="replace">
                <button name="action_view_invoice" type="object" class="oe_stat_button" icon="fa-pencil-square-o" attrs="{'invisible': [('invoice_count', '=', 0)]}" groups="sunfire_sales.smart_invoices_button_user">
                    <field name="invoice_count" widget="statinfo" string="Invoices"/>
                </button>
            </xpath>
            <!-- ####################Sale Order header tweaks##########################  -->
            <xpath expr="//field[@name='partner_id']" position="replace">
                <field name="partner_id" domain="[('customer','=',True),('parent_id','=',False)]" context="{'search_default_customer':1, 'show_address': 1,'default_type':'contact'}" options='{"always_reload": True}'/>
            </xpath>

            <xpath expr="//field[@name='validity_date']" position="replace">
                <field name="validity_dt" string="Proposal Validity(Days)"/>
            </xpath>

            <xpath expr="//field[@name='partner_invoice_id']" position="replace">
                <field name="partner_invoice_id" string="Billing Address" groups="sale.group_delivery_invoice_address" context="{'show_address': 1}" options='{"always_reload": True}'/>
                <!-- <field name="partner_invoice_Add" /> -->
            </xpath>
            <xpath expr="//field[@name='client_order_ref']" position="replace">
                <field name="client_order_ref" string="Customer PO and Dt."/>
            </xpath>
            <xpath expr="//field[@name='payment_term_id']" position="replace">
                <field name="payment_term_id" string="Credit Terms" options="{'no_create': True}"/>
            </xpath>
            <xpath expr="//field[@name='partner_shipping_id']" position="replace">
                <field name="partner_shipping_id" string="Shipping Address" groups="sale.group_delivery_invoice_address" context="{'show_address': 1}" options='{"always_reload": True}'/>
                <!-- <field name="partner_shipping_Add" /> -->
                <field name="opportunity_stages"/>
                <field name="sales_stages"/>
            </xpath>
            <xpath expr="//field[@name='pricelist_id']" position='replace'>
                <field name="pricelist_id" string="OPF Type" groups="product.group_sale_pricelist"/>
            </xpath>
            <!--################## SaleOrderLine Tree on SaleOrder Form################## -->
            <xpath expr="//field[@name='order_line']" position="replace">
                <group></group>
                <button class="oe_inline oe_stat_button" type="object" name="open_import_product_list" string="Import"/>
                <group></group>
                <!-- <group></group>
                <button class="oe_inline oe_stat_button" type="object" name="uss_excel_report" string="Download template"/>
                <group></group> -->
                <div class="table oe-inline table-responsive">
                    <field name="order_line" mode="tree,kanban" attrs="{'readonly': [('state', 'in', ('done','cancel'))]}">

                        <tree string="Sales Order Lines" editable="bottom" decoration-info="invoice_status=='to invoice'">
                            <field name="sequence" widget="handle"/>
                            <field name="product_updatable" invisible="1"/>
                            <field name="layout_category_id" string="Product Heading" style="min-width: 98px;" groups="sale.group_sale_layout"/>
                            <!-- <field name="default_code" style="min-width: 98px;"> -->
                            <field name="product_id" string="Part No" style="min-width: 190px;" options="{'no_create_edit':'1','no_open':'1'}" attrs="{'readonly': [('product_updatable', '=', False)]}" force_save="1" context="{'partner_id':parent.partner_id, 'quantity':product_uom_qty, 'pricelist':parent.pricelist_id, 'uom':product_uom, 'company_id': parent.company_id}" />
                            <field name="desc_name" style="min-width: 170px;"/>
                            <field name="i_type" style="min-width: 130px;"/>
                            <field name="categ_id" string="Vendor / Group / SubGroup" style="min-width: 178px;"/>
                            <field name="dr_done" style="min-width: 102px;"/>
                            <field name="dr_status" style="min-width: 85px;"/>
                            <field name="dr_remark" style="min-width: 102px;"/>
                            <field name="dr_date" style="min-width: 92px;"/>
                            <field name="l10n_in_hsn_code" style="min-width: 92px;" />
                            <field name="cross_sell" style="min-width: 92px;"/>
                            <!--LOB (Master)-->
                            <field name="line_of_business" style="min-width: 112px;"/>
                            <!-- <field name="model_group_code" style="min-width: 92px;"/> -->
                            <field name="product_uom_qty" string="Ordered Qty" context="{'partner_id':parent.partner_id, 'quantity':product_uom_qty, 'pricelist':parent.pricelist_id, 'uom':product_uom, 'company_id': parent.company_id}" />
                            <field name="qty_delivered" invisible="1" attrs="{'column_invisible': [('parent.state', 'not in', ['sale', 'done'])], 'readonly': [('qty_delivered_updateable', '=', False)]}"/>
                            <field name="qty_invoiced" invisible="1" attrs="{'column_invisible': [('parent.state', 'not in', ['sale', 'done'])]}"/>
                            <field name="qty_to_invoice" invisible="1"/>
                            <field name="product_uom" style="min-width: 79px;" attrs="{'readonly': [('state', 'in', ('sale','done', 'cancel'))]}" context="{'company_id': parent.company_id}" groups="product.group_uom" options='{"no_open": True}'/>
                            <field name="analytic_tag_ids" groups="analytic.group_analytic_accounting" widget="many2many_tags" options="{'color_field': 'color'}"/>
                            <field name="purchase_price" string="STP" groups="base.group_user" style="min-width: 92px;"/>
                            <field name="margin_type"/>
                            <field name="margin_value" string="Margin Amount" style="min-width: 92px;"/>
                            <field name="price_unit" style="min-width: 92px;" attrs="{'readonly': [('qty_invoiced', '&gt;', 0)]}"/>
                            <field name="tax_id" widget="many2many_tags" style="min-width: 92px;" options="{'no_create': True}" domain="[('type_tax_use','=','sale'),('company_id','=',parent.company_id)]" attrs="{'readonly': [('qty_invoiced', '&gt;', 0)]}"/>
                            <field name="discount" groups="sale.group_discount_per_so_line"/>
                            <field name="price_subtotal" widget="monetary" groups="sale.group_show_price_subtotal" style="min-width: 92px;"/>
                            <field name="price_total" widget="monetary" groups="sale.group_show_price_total"/>
                            <field name="qty_delivered_updateable" invisible="1"/>
                            <field name="state" invisible="1"/>
                            <field name="invoice_status" invisible="1"/>
                            <field name="customer_lead" invisible="1"/>
                            <field name="currency_id" invisible="1"/>
                        </tree>

                        <kanban class="o_kanban_mobile">
                            <field name="product_id"/>
                            <field name="product_uom_qty"/>
                            <field name="product_uom" groups="product.group_uom"/>
                            <field name="price_subtotal"/>
                            <field name="price_unit"/>
                            <templates>
                                <t t-name="kanban-box">
                                    <div t-attf-class="oe_kanban_card oe_kanban_global_click">
                                        <div class="row">
                                            <div class="col-xs-8">
                                                <strong>
                                                    <span>
                                                        <t t-esc="record.product_id.value"/>
                                                    </span>
                                                </strong>
                                            </div>
                                            <div class="col-xs-4">
                                                <strong>
                                                    <span class="pull-right text-right">
                                                        <t t-esc="record.price_subtotal.value"/>
                                                    </span>
                                                </strong>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-xs-12 text-muted">
                                                <span>Quantity:                                                    <t t-esc="record.product_uom_qty.value"/>
                                                    <t t-esc="record.product_uom.value"/>
                                                </span>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-xs-12 text-muted">
                                                <span>Unit Price:                                                    <t t-esc="record.price_unit.value"/>
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                    <hr/>
                                </t>
                            </templates>
                        </kanban>
                    </field>
                </div>
            </xpath>
            <!-- Extra Fields in Other Information of Sale Order form -->
            <xpath expr="//group[@name='technical']" position='after'>
                <group string="Extras">
                    <field name="delivery_terms"/>
                    <field name="tax_grp"/>
                    <field name="installation_terms"/>
                    <field name="pre_sale_engaged"/>
                    <field name="transport_modes"/>
                    <field name="warranty" string="Warranty Terms"/>
                    <field name='po_to_be_placed' domain="[('id','=','1')]" options="{'no_quick_create':True,'no_create_edit':True}"/>
                    <field name='po_detail_address' options="{'no_quick_create':True,'no_create_edit':True}"/>
                    <field name="addr"/>
                </group>
            </xpath>
            <xpath expr="//group[@name='sale_pay']/field[@name='fiscal_position_id']" position="after">
                <field string="Billing from" name="vendor_id" context="{'search_default_supplier':1, 'default_supplier':1, 'default_customer':0}" domain="[('supplier','=',True)]"/>
                <field string="Billing Location" name="billing_location"/>
                <field string="Invoice Advice" name="invoice_advice"/>
                <field string="PO Advice" name="po_advice"/>
            </xpath>
            <xpath expr="//group[@name='sales_person']/field[@name='analytic_account_id']" position="after">
                <field string="Concern Person" name="concern_person" context="{'show_address':1,'show_mobile':1,'show_email':1}"/>
                <field string="Email" name="concern_email"/>
                <field string="Mobile No." name="concern_mobile"/>
            </xpath>
            <xpath expr="//field[@name='name']" position="after">
                <div>
                    <h1>
                        <field name="opf_name" readonly="1" domain="[('state','in',('sale','done'))]"/>
                    </h1>
                </div>
            </xpath>
            <xpath expr="//field[@name='payment_term_id']" position='before'>
                <field name='cust_type'/>
            </xpath>
        </field>
    </record>
    <!-- Buttons Visibility -->
    <record model="ir.ui.view" id="sale.view_order_form_inherited_edit_button">
        <field name="name">sale.order.inherit</field>
        <field name="model">sale.order</field>
        <field name="inherit_id" ref="sale.view_order_form"/>
        <field name="groups_id" eval="[(6,0,[ref('edit_button_user')])]"/>
        <field name="arch" type="xml">

            <xpath expr="/form" position="attributes">
                <attribute name="create">false</attribute>
                <attribute name="edit">false</attribute>
            </xpath>
        </field>
    </record>

    <record model="ir.ui.view" id="sale.view_order_form_inherited_delete_buttons">
        <field name="name">sale.order.inherit</field>
        <field name="model">sale.order</field>
        <field name="inherit_id" ref="sale.view_order_form"/>
        <field name="groups_id" eval="[(6,0,[ref('delete_button_user')])]"/>

        <field name="arch" type="xml">
            <xpath expr="/form" position="attributes">
                <attribute name="delete">false</attribute>
            </xpath>
        </field>
    </record>

    <record model="ir.ui.view" id="sale.view_order_form_inherited_dup_button">
        <field name="name">sale.order.inherit</field>
        <field name="model">sale.order</field>
        <field name="inherit_id" ref="sale.view_order_form"/>
        <field name="groups_id" eval="[(6,0,[ref('duplicate_button_user')])]"/>

        <field name="arch" type="xml">
            <xpath expr="/form" position="attributes">
                <attribute name="duplicate">false</attribute>
            </xpath>
        </field>
    </record>


    <record model="ir.ui.view" id="sale.view_order_form_inherited_create_button">
        <field name="name">sale.order.inherit</field>
        <field name="model">sale.order</field>
        <field name="inherit_id" ref="sale.view_order_form"/>
        <field name="groups_id" eval="[(6,0,[ref('create_button_user')])]"/>
        <field name="arch" type="xml">
            <xpath expr="/form" position="attributes">
                <attribute name="create">false</attribute>
            </xpath>
        </field>
    </record>
    <!-- asle_order Quotation inherit tree view -->
    <record id="view_quitation_tree_inhe" model="ir.ui.view">
        <field name="name">sale.order.inherit.quotationview.tree</field>
        <field name="model">sale.order</field>
        <field name="inherit_id" ref="sale.view_quotation_tree"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='date_order']" position="after">
                <field name="opf_name" string="OPF Number"/>
                <field name="confirmation_date" string="OPF Date"/>
            </xpath>
        </field>
    </record>

    <record id="view_order_tree_inhe" model="ir.ui.view">
        <field name="name">sale.order.inherit.orderview.tree</field>
        <field name="model">sale.order</field>
        <field name="inherit_id" ref="sale.view_order_tree"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='name']" position="replace">
                <field name="name" string="Quotation Number"/>
                <field name="opf_name" string="OPF Number"/>
            </xpath>
            <xpath expr="//field[@name='confirmation_date']" position="replace">
                <field name="confirmation_date" string="OPF Date"/>
            </xpath>
        </field>
    </record>
</odoo>
